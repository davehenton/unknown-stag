a8336d10302d81f1df37caf1e64cc230
'use strict';Object.defineProperty(exports, "__esModule", { value: true });var _jsxFileName = '/buddy/unknown-stag/src/components/LogIn/LogIn.js';var _react = require('react');var _react2 = _interopRequireDefault(_react);
var _fire = require('../../fire');var _fire2 = _interopRequireDefault(_fire);
var _firebase = require('firebase');var _firebase2 = _interopRequireDefault(_firebase);function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}

class LogIn extends _react.Component {
    constructor(props) {
        super(props);
        this.state = {
            loggedIn: true };

    }
    componentWillMount() {
        _fire2.default.auth().onAuthStateChanged(user => {
            if (!user) {
                this.setState({ loggedIn: false });
                return;
            }
        });
    }
    logInWithGoogle(e) {
        this.setState({ loggedIn: true });
        e.preventDefault();
        const provider = new _firebase2.default.auth.GoogleAuthProvider();
        _fire2.default.auth().signInWithPopup(provider).then(function (result) {
            const currentUser = _fire2.default.auth().currentUser;
            const userId = currentUser.uid;
            return _fire2.default.database().ref('/users/' + userId).once('value').then(function (snapshot) {
                const username = snapshot.val() && snapshot.val().displayName || 'Anonymous';
                if (username === 'Anonymous') {
                    _fire2.default.database().ref('users/' + userId).set({
                        displayName: currentUser.displayName,
                        email: currentUser.email,
                        photoURL: currentUser.photoURL,
                        admin: {
                            admin: false,
                            license: 0 } });


                } else {}
            });
        }).catch(error => {
            console.log(error);
            this.setState({ loggedIn: false });
        });
    }
    render() {
        return (
            _react2.default.createElement('div', { hidden: this.state.loggedIn, __source: { fileName: _jsxFileName, lineNumber: 48 }, __self: this },
                _react2.default.createElement('div', { className: 'row', __source: { fileName: _jsxFileName, lineNumber: 49 }, __self: this },
                    _react2.default.createElement('div', { className: 'col s12 m6', __source: { fileName: _jsxFileName, lineNumber: 50 }, __self: this },
                        _react2.default.createElement('div', { className: 'card grey darken-4', __source: { fileName: _jsxFileName, lineNumber: 51 }, __self: this },
                            _react2.default.createElement('div', { className: 'card-content white-text', __source: { fileName: _jsxFileName, lineNumber: 52 }, __self: this },
                                _react2.default.createElement('span', { className: 'card-title', __source: { fileName: _jsxFileName, lineNumber: 53 }, __self: this }, 'Welcome'),
                                _react2.default.createElement('p', { __source: { fileName: _jsxFileName, lineNumber: 54 }, __self: this }, 'Please log in or sign up with Google to start using Unknown Stag for your points poker session. '))),




                        _react2.default.createElement('form', { className: 'col s12', onSubmit: this.logInWithGoogle.bind(this), __source: { fileName: _jsxFileName, lineNumber: 59 }, __self: this },
                            _react2.default.createElement('input', { className: 'btn waves-effect waves-light red', type: 'submit', value: 'Log In / Sign Up', __source: { fileName: _jsxFileName, lineNumber: 60 }, __self: this }))))));





    }}exports.default =

LogIn;